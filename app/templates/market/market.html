<div class="col-sm-12">
  <div class="header m-bottom">
    <div class="account-selector pull-right">
      <span class="title">Account &nbsp;</span>
      <div class="btn-group" dropdown is-open="status.isopen">
        <button type="button" class="btn btn-primary dropdown-toggle">
          {{account ? account.name : 'Select Account'}} <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
          <li ng-repeat="(key,a) in accounts">
            <a ui-sref="market.buy({account: '{{a.name}}', market: '{{market.name}}'})">{{a.name}}</a>
          </li>
        </ul>
      </div>
      <div class="balance">
        <span>{{account.quantity_balance | formatDecimal : market.quantity_precision}} {{market.quantity_symbol}} / {{account.base_balance | formatDecimal : market.base_precision}} {{market.base_symbol}}</span>
      </div>
    </div>

    <div class="row">
      <h3 class="col-sm-3 header-title">
        <span tooltip="{{market.quantity_asset.description}}" tooltip-placement="right">{{market.quantity_symbol}}</span>
        : <span tooltip="{{market.base_asset.description}}" tooltip-placement="right">{{market.base_symbol}}</span>
        <a ng-click="flip_market()" class="small" tooltip="Flip market" tooltip-placement="right" ng-show="account"><i class="fa fa-retweet fa-fw"></i></a>
      </h3>
      <ul class="col-sm-6 market-stats stats">
        <li ng-show="true || market.shorts_available" class="stat col-sm-4">
          <span>Median&nbsp;Price<br/><b class="value">{{market.median_price | formatDecimal : market.price_precision : true}}</b><br/><em>{{market.price_symbol}}</em></span>
        </li>
        <li ng-show="!market.shorts_available || market.avg_price_1h > 0" class="stat col-sm-4">
          <span>1h&nbsp;Avg.&nbsp;Price<br/><b class="value">{{market.avg_price_1h | formatDecimal : market.price_precision : true}}</b><br/><em>{{market.price_symbol}}</em></span>
        </li>
        <li class="stat col-sm-4">
          <span>Bid&nbsp;Depth<br/><b class="value">{{market.bid_depth | formatDecimal : actual_market.quantity_precision}}</b><br/><em>{{actual_market.quantity_symbol}}</em></span>
        </li>
        <li class="stat col-sm-4">
          <span>Ask&nbsp;Depth<br/><b class="value">{{market.ask_depth | formatDecimal : actual_market.quantity_precision}}</b><br/><em>{{actual_market.quantity_symbol}}</em></span>
        </li>
      </ul>
    </div>
    <div class="row" ng-show="market.error.title">
      <div class="col-sm-2">&nbsp;</div>
      <div class="col-sm-8">
        <div class="alert alert-danger">
          <i class="fa fa-warning"></i>
          &nbsp; &nbsp; <strong>{{market.error.title}}</strong> &nbsp; &nbsp; {{market.error.text}}
        </div>
      </div>
      <div class="col-sm-2">&nbsp;</div>
    </div>

  </div>
</div>

<div class="main-content market">

    <div class="row">
      <div class="col-sm-12">
        <nvd3-line-chart class="chart price-chart" ng-show="market.price_history.length"
                         data="market.price_history"
                         showXAxis="true"
                         showYAxis="true"
                         tooltips="true"
                         interactive="true"
                         showlegend="true"
                         yaxisshowmaxmin="false"
                         height="240"
                         xAxisLabel=""
                         yAxisLabel=""
                         xAxisTickFormat="xAxisTickFormatPriceChart()"
                         yAxisTickFormat="yAxisTickFormatPriceChart()"
                         tooltipcontent="priceChartTooltip()">
        </nvd3-line-chart>
      </div>
    </div>

    <div class="row">

      <div class="col-md-5">
        <tabset>
          <tab ng-repeat="t in tabs" heading="{{t.heading}}" ng-click="goto_tab(t.route)" active="t.active">
            <div class="panel">
              <div class="panel-body">
                <div ui-view></div>
              </div>
            </div>
          </tab>
        </tabset>
      </div>

      <div class="col-md-7">
          <div class="panel">
            <div class="panel-heading">
              <h3 class="panel-title">Open Orders (Account: {{account.name}})</h3>
            </div>
            <div class="panel-body">
              <div ng-include src="'market/orders.html'"></div>
            </div>
          </div>
      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <nvd3-line-chart class="chart orderbook-chart" ng-show="market.orderbook_chart_data.length > 0"
                         data="market.orderbook_chart_data"
                         showXAxis="true"
                         showYAxis="true"
                         tooltips="true"
                         interactive="true"
                         showlegend="true"
                         height="180"
                         margin="60"
                         yaxisshowmaxmin="false"
                         xAxisLabel=""
                         yAxisLabel=""
                         xAxisTickFormat="xAxisTickFormatOrderbookChart()"
                         yAxisTickFormat="yAxisTickFormatOrderbookChart()"
                         tooltips="true"
                         tooltipcontent="orderbookChartTooltip()" >
        </nvd3-line-chart>
      </div>
    </div>

    <br ng-show="market.orderbook_chart_data.length == 0" />
    <div ng-switch on="state_name">

      <div class="row" ng-switch-when="market.short">
        <div class="col-sm-6">
          <div class="panel ">
            <div class="panel-heading">
              <h3 class="panel-title">Buy Orders (Bids)</h3>
            </div>
            <div class="panel-body">
              <div ng-include src="'market/bids.html'"></div>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="panel ">
            <div class="panel-heading">
              <h3 class="panel-title">Short Orders</h3>
            </div>
            <div class="panel-body">
              <div ng-include src="'market/shorts.html'"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row orders-row" ng-switch-default>
        <div class="col-lg-4 panel">
          <div class="panel-heading">
            <h3 class="panel-title">Buy Orders ({{market.inverted ? 'Bids' : 'Bids and Shorts'}})</h3>
          </div>
          <div class="panel-body">
            <div ng-include src="'market/bids.html'"></div>
          </div>
        </div>
        <div class="col-lg-4 panel">
          <div class="panel-heading">
            <h3 class="panel-title">Sell Orders ({{market.inverted ? 'Asks and Shorts' : 'Asks'}})</h3>
          </div>
          <div class="panel-body">
            <div ng-include src="'market/asks.html'"></div>
          </div>
        </div>
        <div class="col-lg-4 panel">
          <div class="panel-heading">
            <h3 class="panel-title">
              Margin Orders
              &nbsp; <span class="help-popover"
                  popover="Margin orders will execute automatically when the highest bid falls below the call price and is within 10% of the 1 hour moving average. The call price is the price at which 75% of your collateral is required to buy back the USD owed.  When your position is called your collateral will be used to buy BitUSD and if there is any collateral remaining after the short position is fully covered then 95% will be returned to the short, the remaining 5% will be kept by the network as fees. "
                  popover-append-to-body="true"
                  popover-trigger="mouseenter">?</span>
            </h3>
          </div>
          <div class="panel-body">
            <div ng-include src="'market/covers.html'"></div>
          </div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="panel ">
          <div class="panel-heading">
            <h3 class="panel-title">Orders History</h3>
          </div>
          <div class="panel-body">
            <div ng-include src="'market/trades.html'"></div>
          </div>
        </div>
      </div>
    </div>

</div>
